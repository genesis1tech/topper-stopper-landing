---
import { ArrowRight } from '@lucide/astro';

const stats = [
  { id: 'stat-pickups', value: 30, label: 'Fewer Pickups', sublabel: '15-30% reduction' },
  {
    id: 'stat-contamination',
    value: 85,
    label: 'Contamination Reduction',
    sublabel: 'Up to 85%',
  },
  { value: '24/7', label: 'Real-Time Monitoring', sublabel: 'Always connected' },
  { value: '100%', label: 'Data Visibility', sublabel: 'Complete insights' },
];
---

<section id="results" class="bg-gradient-to-b from-emerald-50/20 via-green-50/30 to-emerald-50/20 px-6 py-24">
  <div class="mx-auto max-w-7xl">
    <div class="fade-in-section rounded-[3rem] bg-emerald-900 p-8 text-white shadow-2xl md:p-16">
      <div class="mb-12 text-center">
        <h2 class="mb-4 text-3xl font-bold md:text-4xl">Proven Results</h2>
        <p class="mx-auto max-w-2xl text-xl text-emerald-200">
          Organizations using Topper Stopperâ„¢ see transformative improvements
        </p>
      </div>

      <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-4">
        {
          stats.map(({ id, value, label, sublabel }) => (
            <div class="text-center">
              <div class="mb-2 text-5xl font-bold text-emerald-300 md:text-6xl">
                {typeof value === 'number' ? (
                  <>
                    <span id={id}>0</span>%
                  </>
                ) : (
                  value
                )}
              </div>
              <div class="text-lg text-emerald-100">{label}</div>
              <div class="mt-1 text-sm text-emerald-400/60">{sublabel}</div>
            </div>
          ))
        }
      </div>

      <div class="mt-12 border-t border-emerald-800/50 pt-12 text-center">
        <p class="mb-6 text-lg text-emerald-200">
          Lower hauling costs. Improved recovery. Smarter operations.
        </p>
        <a
          href="#contact"
          class="inline-flex items-center gap-2 rounded-full bg-white px-8 py-4 text-lg font-medium text-emerald-800 transition-all hover:bg-emerald-50 hover:scale-105"
        >
          See It In Action
          <ArrowRight class="h-5 w-5" />
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  function animateValue(id: string, start: number, end: number, duration: number) {
    const element = document.getElementById(id);
    if (!element) return;

    let startTimestamp: number | null = null;
    const step = (timestamp: number) => {
      if (!startTimestamp) startTimestamp = timestamp;
      const progress = Math.min((timestamp - startTimestamp) / duration, 1);
      element.textContent = Math.floor(progress * (end - start) + start).toString();
      if (progress < 1) {
        window.requestAnimationFrame(step);
      }
    };
    window.requestAnimationFrame(step);
  }

  const statsSection = document.getElementById('results');
  let statsAnimated = false;

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting && !statsAnimated) {
          statsAnimated = true;
          animateValue('stat-pickups', 0, 30, 2000);
          animateValue('stat-contamination', 0, 85, 2000);
        }
      });
    },
    { threshold: 0.3 }
  );

  if (statsSection) {
    observer.observe(statsSection);
  }
</script>
